using System;
using System.IO;
using System.Linq;
using System.Xml;
using PatientAccess.Domain;
using PatientAccess.Persistence;
using NUnit.Framework;

namespace Tests.Integration.PatientAccess.Persistence
{
    [TestFixture]
    public class ParseCoverageContextTest : AbstractBrokerTests
    {

        [Test]
        public void TestCommercialPercentageCreated()
        {
            SetCoverageStrategy(typeof(CommercialCoverage).ToString(), typeof(CommercialCoverage) + "-WithNewPercentField");
            Assert.IsTrue(benResponse.CoverageConstraintsCollection.Count > 0, "The response was expecting at lease" +
              " one constraint to be added to the CoverageConstraints collection");

        }
        [Test]
        public void TestCommercialConstraintCreated()
        {
            SetCoverageStrategy(typeof(CommercialCoverage).ToString(), typeof(CommercialCoverage).ToString());
            Assert.IsTrue(benResponse.CoverageConstraintsCollection.Count > 0, "The response was expecting at lease" +
              " one constraint to be added to the CoverageConstraints collection");

        }

        [Test]
        public void TestCommercialInAndOutOfNetworkConstraintCreated()
        {
            SetCoverageStrategy(typeof(CommercialCoverage) + "-InOut", typeof(CommercialCoverage) + "-InOut");
            Assert.IsTrue(benResponse.CoverageConstraintsCollection.Count == 2, "The response was expecting at lease" +
              " one constraint to be added to the CoverageConstraints collection");
            CommercialCoverage coverage = new CommercialCoverage();
            coverage.SetCoverageConstraints((CoverageConstraints)benResponse.CoverageConstraintsCollection[0]);
        }

        [Test]
        public void TestMedicareConstraintCreated()
        {

            SetCoverageStrategy(typeof(GovernmentMedicareCoverage).ToString(), typeof(GovernmentMedicareCoverage).ToString());
            Assert.IsTrue(benResponse.CoverageConstraintsCollection.Count > 0, "The response was expecting at lease" +
                " one constraint to be added to the CoverageConstraints collection");
        }

        [Test]
        public void TestMedicare_EDV5010_DateTimeQualified307()
        {
            benResponse.CoverageConstraintsCollection.Clear();
            benResponse.ReturnedDataValidationTicket = new DataValidationTicket();
            benResponse.PayorXmlMessage = "<?xml version=\"1.0\"?><BenefitResponse><TranSetHeader><TransactionSetIdentifierCode>271</TransactionSetIdentifierCode><TransactionSetControlNumber>0001</TransactionSetControlNumber><ImplementationConventionReference>005010X279A1</ImplementationConventionReference></TranSetHeader><BeginningHierarchicalTran><HierarchicalStructureCode>0022</HierarchicalStructureCode><TransactionSetPurposeCode>11</TransactionSetPurposeCode><ReferenceIdentification>10564131</ReferenceIdentification><Date>20111209</Date><Time>10592109</Time></BeginningHierarchicalTran><InformationSourceLevel><HierarchicalLevel><HierarchicalIdNumber>1</HierarchicalIdNumber><HierarchicalLevelCode>20</HierarchicalLevelCode><HierarchicalChildCode>1</HierarchicalChildCode></HierarchicalLevel><InformationSourceName><Name><EntityIdentifierCode1>PR</EntityIdentifierCode1><EntityTypeQualifier>2</EntityTypeQualifier><NameLastOrOrganizationName>CMS</NameLastOrOrganizationName><IdentificationCodeQualifier>PI</IdentificationCodeQualifier><IdentificationCode>CMS</IdentificationCode></Name><ContactInformation><ContactFunctionCode>IC</ContactFunctionCode><CommunicationNumberQualifier1>UR</CommunicationNumberQualifier1><CommunicationNumber1>http://www.cms.gov/HETSHelp/</CommunicationNumber1><CommunicationNumberQualifier2>UR</CommunicationNumberQualifier2><CommunicationNumber2>http://www.cms.gov/center/provider.asp</CommunicationNumber2></ContactInformation></InformationSourceName><InformationReceiverLevel><HierarchicalLevel2><HierarchicalIdNumber>2</HierarchicalIdNumber><HierarchicalParentIdNumber>1</HierarchicalParentIdNumber><HierarchicalLevelCode>21</HierarchicalLevelCode><HierarchicalChildCode>1</HierarchicalChildCode></HierarchicalLevel2><InformationReceiverName><Name><EntityIdentifierCode1>1P</EntityIdentifierCode1><EntityTypeQualifier>2</EntityTypeQualifier><NameLastOrOrganizationName>DHW</NameLastOrOrganizationName><IdentificationCodeQualifier>XX</IdentificationCodeQualifier><IdentificationCode>1407886385</IdentificationCode></Name></InformationReceiverName><SubscriberLevel><HierarchicalLevel5><HierarchicalIdNumber>3</HierarchicalIdNumber><HierarchicalParentIdNumber>2</HierarchicalParentIdNumber><HierarchicalLevelCode>22</HierarchicalLevelCode><HierarchicalChildCode>0</HierarchicalChildCode></HierarchicalLevel5><SubscriberName><Name><EntityIdentifierCode1>IL</EntityIdentifierCode1><EntityTypeQualifier>1</EntityTypeQualifier><NameLastOrOrganizationName>LAWRENCE</NameLastOrOrganizationName><NameFirst>MICHAEL</NameFirst><NameMiddle>L</NameMiddle><IdentificationCodeQualifier>MI</IdentificationCodeQualifier><IdentificationCode>306340099A</IdentificationCode></Name><Address><AddressInformation1>112 VERRAZANNO</AddressInformation1></Address><CityStateZip><CityName>HIGHLAND</CityName><StateOrProvinceCode>IL</StateOrProvinceCode><PostalCode>622494884</PostalCode></CityStateZip><Demographic><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>19360914</DateTimePeriod><GenderCode>M</GenderCode><Quantity>0.0</Quantity></Demographic><DatePeriod><DateTimeQualifier>307</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20111209</DateTimePeriod></DatePeriod><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>1</EligibilityOrBenefitInformation><ServiceTypeCode>1</ServiceTypeCode><ServiceTypeCode>33</ServiceTypeCode><ServiceTypeCode>35</ServiceTypeCode><ServiceTypeCode>86</ServiceTypeCode><ServiceTypeCode>AL</ServiceTypeCode><ServiceTypeCode>MH</ServiceTypeCode><ServiceTypeCode>UC</ServiceTypeCode><ServiceTypeCode>47</ServiceTypeCode><ServiceTypeCode>98</ServiceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity></BenefitInformation></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>1</EligibilityOrBenefitInformation><ServiceTypeCode>30</ServiceTypeCode><InsuranceTypeCode>MA</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity></BenefitInformation><DatePeriod><DateTimeQualifier>307</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>2001090122</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>1</EligibilityOrBenefitInformation><ServiceTypeCode>30</ServiceTypeCode><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity></BenefitInformation><DatePeriod><DateTimeQualifier>307</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20011022</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>C</EligibilityOrBenefitInformation><ServiceTypeCode>96</ServiceTypeCode><InsuranceTypeCode>MB</InsuranceTypeCode><TimePeriodQualifier>29</TimePeriodQualifier><MonetaryAmount>0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity></BenefitInformation><DatePeriod><DateTimeQualifier>292</DateTimeQualifier><DateTimePeriodFormatQualifier>RD8</DateTimePeriodFormatQualifier><DateTimePeriod>20110101-20111231</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0439</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20110101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0438</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20110101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G9143</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20090803</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0389</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20070701</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>82270</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20070101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>84478</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20050101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>83718</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20050101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>82950</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20050101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>82951</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20050101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>80061</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20050101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>82465</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20050101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>82947</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20050101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0328</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20040101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0118</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20020101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0117</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20020101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0102</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20010901</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0105</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20010901</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0104</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20010901</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0103</ProductServiceId><ProcedureModifier1>26</ProcedureModifier1></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20010901</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0103</ProductServiceId><ProcedureModifier1>TC</ProcedureModifier1></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20080201</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0120</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20010901</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0107</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20010901</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0106</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20010901</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0121</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20010901</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>F</EligibilityOrBenefitInformation><ServiceTypeCode>67</ServiceTypeCode><InsuranceTypeCode>MB</InsuranceTypeCode><TimePeriodQualifier>29</TimePeriodQualifier><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><QuantityQualifier>P6</QuantityQualifier><Quantity>8</Quantity></BenefitInformation></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>F</EligibilityOrBenefitInformation><ServiceTypeCode>AD</ServiceTypeCode><InsuranceTypeCode>MB</InsuranceTypeCode><TimePeriodQualifier>29</TimePeriodQualifier><MonetaryAmount>1870</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity></BenefitInformation><DatePeriod><DateTimeQualifier>292</DateTimeQualifier><DateTimePeriodFormatQualifier>RD8</DateTimePeriodFormatQualifier><DateTimePeriod>20110101-20111231</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>F</EligibilityOrBenefitInformation><ServiceTypeCode>AE</ServiceTypeCode><InsuranceTypeCode>MB</InsuranceTypeCode><TimePeriodQualifier>29</TimePeriodQualifier><MonetaryAmount>1870</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity></BenefitInformation><DatePeriod><DateTimeQualifier>292</DateTimeQualifier><DateTimePeriodFormatQualifier>RD8</DateTimePeriodFormatQualifier><DateTimePeriod>20110101-20111231</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>F</EligibilityOrBenefitInformation><ServiceTypeCode>BF</ServiceTypeCode><InsuranceTypeCode>MB</InsuranceTypeCode><TimePeriodQualifier>29</TimePeriodQualifier><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><QuantityQualifier>CA</QuantityQualifier><Quantity>72</Quantity></BenefitInformation></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>F</EligibilityOrBenefitInformation><ServiceTypeCode>BG</ServiceTypeCode><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><QuantityQualifier>99</QuantityQualifier><Quantity>0</Quantity></BenefitInformation></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>F</EligibilityOrBenefitInformation><ServiceTypeCode>BG</ServiceTypeCode><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><QuantityQualifier>99</QuantityQualifier><Quantity>0</Quantity></BenefitInformation><MessageText><FreeFormMessageText>Intensive Cardiac Rehabilitation</FreeFormMessageText><Number>0</Number></MessageText></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><ServiceTypeCode>10</ServiceTypeCode><TimePeriodQualifier>29</TimePeriodQualifier><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><QuantityQualifier>DB</QuantityQualifier><Quantity>3</Quantity></BenefitInformation><DatePeriod><DateTimeQualifier>292</DateTimeQualifier><DateTimePeriodFormatQualifier>RD8</DateTimePeriodFormatQualifier><DateTimePeriod>20110101-20111231</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>R</EligibilityOrBenefitInformation><ServiceTypeCode>88</ServiceTypeCode><InsuranceTypeCode>OT</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity></BenefitInformation><AdditionalIdentification><ReferenceIdentificationQualifier>18</ReferenceIdentificationQualifier><ReferenceIdentification>S5715 001</ReferenceIdentification></AdditionalIdentification><DatePeriod><DateTimeQualifier>292</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20060501</DateTimePeriod></DatePeriod><LoopHeader><LoopIdentifierCode>2120</LoopIdentifierCode></LoopHeader><SubscriberBenefitRelatedEntityName><Name><EntityIdentifierCode1>PR</EntityIdentifierCode1><EntityTypeQualifier>2</EntityTypeQualifier><NameLastOrOrganizationName>HCSC INSURANCE SERVICES COMPANY</NameLastOrOrganizationName></Name><Address><AddressInformation1>1001 E LOOKOUT DR</AddressInformation1></Address><CityStateZip><CityName>RICHARDSON</CityName><StateOrProvinceCode>TX</StateOrProvinceCode><PostalCode>750824144</PostalCode></CityStateZip><ContactInformation><ContactFunctionCode>IC</ContactFunctionCode><CommunicationNumberQualifier1>TE</CommunicationNumberQualifier1><CommunicationNumber1>8882852249</CommunicationNumber1><CommunicationNumberQualifier2>UR</CommunicationNumberQualifier2><CommunicationNumber2>www.yourpartd.com</CommunicationNumber2></ContactInformation></SubscriberBenefitRelatedEntityName><LoopTrailer><LoopIdentifierCode>2120</LoopIdentifierCode></LoopTrailer></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>R</EligibilityOrBenefitInformation><ServiceTypeCode>30</ServiceTypeCode><InsuranceTypeCode>47</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity></BenefitInformation><AdditionalIdentification><ReferenceIdentificationQualifier>IG</ReferenceIdentificationQualifier><ReferenceIdentification>4700108211</ReferenceIdentification></AdditionalIdentification><DatePeriod><DateTimeQualifier>290</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20080606</DateTimePeriod></DatePeriod><LoopHeader><LoopIdentifierCode>2120</LoopIdentifierCode></LoopHeader><SubscriberBenefitRelatedEntityName><Name><EntityIdentifierCode1>PRP</EntityIdentifierCode1><EntityTypeQualifier>2</EntityTypeQualifier><NameLastOrOrganizationName>ZURICH AMERICAN INSURANCE</NameLastOrOrganizationName></Name><Address><AddressInformation1>P O BOX 512000</AddressInformation1></Address><CityStateZip><CityName>INDIANAPOLIS</CityName><StateOrProvinceCode>IN</StateOrProvinceCode><PostalCode>46251</PostalCode></CityStateZip></SubscriberBenefitRelatedEntityName><LoopTrailer><LoopIdentifierCode>2120</LoopIdentifierCode></LoopTrailer></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>R</EligibilityOrBenefitInformation><ServiceTypeCode>30</ServiceTypeCode><InsuranceTypeCode>14</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity></BenefitInformation><DatePeriod><DateTimeQualifier>290</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20080606</DateTimePeriod></DatePeriod><LoopHeader><LoopIdentifierCode>2120</LoopIdentifierCode></LoopHeader><SubscriberBenefitRelatedEntityName><Name><EntityIdentifierCode1>PRP</EntityIdentifierCode1><EntityTypeQualifier>2</EntityTypeQualifier><NameLastOrOrganizationName>AUTO NO FAULT INS</NameLastOrOrganizationName></Name></SubscriberBenefitRelatedEntityName><LoopTrailer><LoopIdentifierCode>2120</LoopIdentifierCode></LoopTrailer></SubscriberBenefitInformation></SubscriberName></SubscriberLevel></InformationReceiverLevel></InformationSourceLevel><TranSetTrailer><NumberOfIncludedSegments>102</NumberOfIncludedSegments><TransactionSetControlNumber>0001</TransactionSetControlNumber></TranSetTrailer></BenefitResponse>";
            benResponse.ReturnedDataValidationTicket.TicketId = "c1519b5e-227e-11e1-a986-41c0bff916c0";
            benResponse.ReturnedDataValidationTicket.BenefitsResponse
                .BenefitsResponseParseStrategy = typeof(GovernmentMedicareCoverage).ToString();
            benResponse.FacilityCode = "DHW";
            ParseCoverageContext pcc = new ParseCoverageContext();
            pcc.ParseAndSetCoverageConstraints(benResponse);


            Assert.IsTrue(benResponse.CoverageConstraintsCollection.Count > 0, "The response was expecting at lease" +
                " one constraint to be added to the CoverageConstraints collection");
            Assert.AreEqual("9/1/2001 12:00:00 AM", ((MedicareConstraints)benResponse.CoverageConstraintsCollection[0]).PartACoverageEffectiveDate.Date.ToString(), "Medicare Part A - Invalid Date parsed");
            Assert.IsTrue(((MedicareConstraints)benResponse.CoverageConstraintsCollection[0]).PartACoverage == YesNoFlag.Yes);
            Assert.AreEqual("10/22/2001 12:00:00 AM", ((MedicareConstraints)benResponse.CoverageConstraintsCollection[0]).PartBCoverageEffectiveDate.Date.ToString(), "Medicare Part B -Invalid Date parsed");
            Assert.IsTrue(((MedicareConstraints)benResponse.CoverageConstraintsCollection[0]).PartBCoverage == YesNoFlag.Yes);

        }

        [Test]
        public void TestMedicare_EDV5010_DateTimeQualified291()
        {
            benResponse.CoverageConstraintsCollection.Clear();
            benResponse.ReturnedDataValidationTicket = new DataValidationTicket();
            benResponse.PayorXmlMessage = "<?xml version=\"1.0\"?><BenefitResponse><TranSetHeader><TransactionSetIdentifierCode>271</TransactionSetIdentifierCode><TransactionSetControlNumber>0001</TransactionSetControlNumber><ImplementationConventionReference>005010X279A1</ImplementationConventionReference></TranSetHeader><BeginningHierarchicalTran><HierarchicalStructureCode>0022</HierarchicalStructureCode><TransactionSetPurposeCode>11</TransactionSetPurposeCode><ReferenceIdentification>10564131</ReferenceIdentification><Date>20111209</Date><Time>10592109</Time></BeginningHierarchicalTran><InformationSourceLevel><HierarchicalLevel><HierarchicalIdNumber>1</HierarchicalIdNumber><HierarchicalLevelCode>20</HierarchicalLevelCode><HierarchicalChildCode>1</HierarchicalChildCode></HierarchicalLevel><InformationSourceName><Name><EntityIdentifierCode1>PR</EntityIdentifierCode1><EntityTypeQualifier>2</EntityTypeQualifier><NameLastOrOrganizationName>CMS</NameLastOrOrganizationName><IdentificationCodeQualifier>PI</IdentificationCodeQualifier><IdentificationCode>CMS</IdentificationCode></Name><ContactInformation><ContactFunctionCode>IC</ContactFunctionCode><CommunicationNumberQualifier1>UR</CommunicationNumberQualifier1><CommunicationNumber1>http://www.cms.gov/HETSHelp/</CommunicationNumber1><CommunicationNumberQualifier2>UR</CommunicationNumberQualifier2><CommunicationNumber2>http://www.cms.gov/center/provider.asp</CommunicationNumber2></ContactInformation></InformationSourceName><InformationReceiverLevel><HierarchicalLevel2><HierarchicalIdNumber>2</HierarchicalIdNumber><HierarchicalParentIdNumber>1</HierarchicalParentIdNumber><HierarchicalLevelCode>21</HierarchicalLevelCode><HierarchicalChildCode>1</HierarchicalChildCode></HierarchicalLevel2><InformationReceiverName><Name><EntityIdentifierCode1>1P</EntityIdentifierCode1><EntityTypeQualifier>2</EntityTypeQualifier><NameLastOrOrganizationName>DHW</NameLastOrOrganizationName><IdentificationCodeQualifier>XX</IdentificationCodeQualifier><IdentificationCode>1407886385</IdentificationCode></Name></InformationReceiverName><SubscriberLevel><HierarchicalLevel5><HierarchicalIdNumber>3</HierarchicalIdNumber><HierarchicalParentIdNumber>2</HierarchicalParentIdNumber><HierarchicalLevelCode>22</HierarchicalLevelCode><HierarchicalChildCode>0</HierarchicalChildCode></HierarchicalLevel5><SubscriberName><Name><EntityIdentifierCode1>IL</EntityIdentifierCode1><EntityTypeQualifier>1</EntityTypeQualifier><NameLastOrOrganizationName>LAWRENCE</NameLastOrOrganizationName><NameFirst>MICHAEL</NameFirst><NameMiddle>L</NameMiddle><IdentificationCodeQualifier>MI</IdentificationCodeQualifier><IdentificationCode>306340099A</IdentificationCode></Name><Address><AddressInformation1>112 VERRAZANNO</AddressInformation1></Address><CityStateZip><CityName>HIGHLAND</CityName><StateOrProvinceCode>IL</StateOrProvinceCode><PostalCode>622494884</PostalCode></CityStateZip><Demographic><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>19360914</DateTimePeriod><GenderCode>M</GenderCode><Quantity>0.0</Quantity></Demographic><DatePeriod><DateTimeQualifier>291</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20111209</DateTimePeriod></DatePeriod><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>1</EligibilityOrBenefitInformation><ServiceTypeCode>1</ServiceTypeCode><ServiceTypeCode>33</ServiceTypeCode><ServiceTypeCode>35</ServiceTypeCode><ServiceTypeCode>86</ServiceTypeCode><ServiceTypeCode>AL</ServiceTypeCode><ServiceTypeCode>MH</ServiceTypeCode><ServiceTypeCode>UC</ServiceTypeCode><ServiceTypeCode>47</ServiceTypeCode><ServiceTypeCode>98</ServiceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity></BenefitInformation></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>1</EligibilityOrBenefitInformation><ServiceTypeCode>30</ServiceTypeCode><InsuranceTypeCode>MA</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity></BenefitInformation><DatePeriod><DateTimeQualifier>291</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>2001090122</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>1</EligibilityOrBenefitInformation><ServiceTypeCode>30</ServiceTypeCode><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity></BenefitInformation><DatePeriod><DateTimeQualifier>291</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20011022</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>C</EligibilityOrBenefitInformation><ServiceTypeCode>96</ServiceTypeCode><InsuranceTypeCode>MB</InsuranceTypeCode><TimePeriodQualifier>29</TimePeriodQualifier><MonetaryAmount>0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity></BenefitInformation><DatePeriod><DateTimeQualifier>292</DateTimeQualifier><DateTimePeriodFormatQualifier>RD8</DateTimePeriodFormatQualifier><DateTimePeriod>20110101-20111231</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0439</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20110101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0438</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20110101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G9143</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20090803</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0389</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20070701</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>82270</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20070101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>84478</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20050101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>83718</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20050101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>82950</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20050101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>82951</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20050101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>80061</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20050101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>82465</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20050101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>82947</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20050101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0328</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20040101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0118</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20020101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0117</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20020101</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0102</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20010901</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0105</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20010901</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0104</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20010901</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0103</ProductServiceId><ProcedureModifier1>26</ProcedureModifier1></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20010901</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0103</ProductServiceId><ProcedureModifier1>TC</ProcedureModifier1></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20080201</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0120</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20010901</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0107</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20010901</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0106</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20010901</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity><CompositeMedicalProcedureIdentifier><MedicalProcedureIdentifier><ProductServiceIdQualifier>HC</ProductServiceIdQualifier><ProductServiceId>G0121</ProductServiceId></MedicalProcedureIdentifier></CompositeMedicalProcedureIdentifier></BenefitInformation><DatePeriod><DateTimeQualifier>348</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20010901</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>F</EligibilityOrBenefitInformation><ServiceTypeCode>67</ServiceTypeCode><InsuranceTypeCode>MB</InsuranceTypeCode><TimePeriodQualifier>29</TimePeriodQualifier><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><QuantityQualifier>P6</QuantityQualifier><Quantity>8</Quantity></BenefitInformation></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>F</EligibilityOrBenefitInformation><ServiceTypeCode>AD</ServiceTypeCode><InsuranceTypeCode>MB</InsuranceTypeCode><TimePeriodQualifier>29</TimePeriodQualifier><MonetaryAmount>1870</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity></BenefitInformation><DatePeriod><DateTimeQualifier>292</DateTimeQualifier><DateTimePeriodFormatQualifier>RD8</DateTimePeriodFormatQualifier><DateTimePeriod>20110101-20111231</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>F</EligibilityOrBenefitInformation><ServiceTypeCode>AE</ServiceTypeCode><InsuranceTypeCode>MB</InsuranceTypeCode><TimePeriodQualifier>29</TimePeriodQualifier><MonetaryAmount>1870</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity></BenefitInformation><DatePeriod><DateTimeQualifier>292</DateTimeQualifier><DateTimePeriodFormatQualifier>RD8</DateTimePeriodFormatQualifier><DateTimePeriod>20110101-20111231</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>F</EligibilityOrBenefitInformation><ServiceTypeCode>BF</ServiceTypeCode><InsuranceTypeCode>MB</InsuranceTypeCode><TimePeriodQualifier>29</TimePeriodQualifier><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><QuantityQualifier>CA</QuantityQualifier><Quantity>72</Quantity></BenefitInformation></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>F</EligibilityOrBenefitInformation><ServiceTypeCode>BG</ServiceTypeCode><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><QuantityQualifier>99</QuantityQualifier><Quantity>0</Quantity></BenefitInformation></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>F</EligibilityOrBenefitInformation><ServiceTypeCode>BG</ServiceTypeCode><InsuranceTypeCode>MB</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><QuantityQualifier>99</QuantityQualifier><Quantity>0</Quantity></BenefitInformation><MessageText><FreeFormMessageText>Intensive Cardiac Rehabilitation</FreeFormMessageText><Number>0</Number></MessageText></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>D</EligibilityOrBenefitInformation><ServiceTypeCode>10</ServiceTypeCode><TimePeriodQualifier>29</TimePeriodQualifier><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><QuantityQualifier>DB</QuantityQualifier><Quantity>3</Quantity></BenefitInformation><DatePeriod><DateTimeQualifier>292</DateTimeQualifier><DateTimePeriodFormatQualifier>RD8</DateTimePeriodFormatQualifier><DateTimePeriod>20110101-20111231</DateTimePeriod></DatePeriod></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>R</EligibilityOrBenefitInformation><ServiceTypeCode>88</ServiceTypeCode><InsuranceTypeCode>OT</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity></BenefitInformation><AdditionalIdentification><ReferenceIdentificationQualifier>18</ReferenceIdentificationQualifier><ReferenceIdentification>S5715 001</ReferenceIdentification></AdditionalIdentification><DatePeriod><DateTimeQualifier>292</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20060501</DateTimePeriod></DatePeriod><LoopHeader><LoopIdentifierCode>2120</LoopIdentifierCode></LoopHeader><SubscriberBenefitRelatedEntityName><Name><EntityIdentifierCode1>PR</EntityIdentifierCode1><EntityTypeQualifier>2</EntityTypeQualifier><NameLastOrOrganizationName>HCSC INSURANCE SERVICES COMPANY</NameLastOrOrganizationName></Name><Address><AddressInformation1>1001 E LOOKOUT DR</AddressInformation1></Address><CityStateZip><CityName>RICHARDSON</CityName><StateOrProvinceCode>TX</StateOrProvinceCode><PostalCode>750824144</PostalCode></CityStateZip><ContactInformation><ContactFunctionCode>IC</ContactFunctionCode><CommunicationNumberQualifier1>TE</CommunicationNumberQualifier1><CommunicationNumber1>8882852249</CommunicationNumber1><CommunicationNumberQualifier2>UR</CommunicationNumberQualifier2><CommunicationNumber2>www.yourpartd.com</CommunicationNumber2></ContactInformation></SubscriberBenefitRelatedEntityName><LoopTrailer><LoopIdentifierCode>2120</LoopIdentifierCode></LoopTrailer></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>R</EligibilityOrBenefitInformation><ServiceTypeCode>30</ServiceTypeCode><InsuranceTypeCode>47</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity></BenefitInformation><AdditionalIdentification><ReferenceIdentificationQualifier>IG</ReferenceIdentificationQualifier><ReferenceIdentification>4700108211</ReferenceIdentification></AdditionalIdentification><DatePeriod><DateTimeQualifier>290</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20080606</DateTimePeriod></DatePeriod><LoopHeader><LoopIdentifierCode>2120</LoopIdentifierCode></LoopHeader><SubscriberBenefitRelatedEntityName><Name><EntityIdentifierCode1>PRP</EntityIdentifierCode1><EntityTypeQualifier>2</EntityTypeQualifier><NameLastOrOrganizationName>ZURICH AMERICAN INSURANCE</NameLastOrOrganizationName></Name><Address><AddressInformation1>P O BOX 512000</AddressInformation1></Address><CityStateZip><CityName>INDIANAPOLIS</CityName><StateOrProvinceCode>IN</StateOrProvinceCode><PostalCode>46251</PostalCode></CityStateZip></SubscriberBenefitRelatedEntityName><LoopTrailer><LoopIdentifierCode>2120</LoopIdentifierCode></LoopTrailer></SubscriberBenefitInformation><SubscriberBenefitInformation><BenefitInformation><EligibilityOrBenefitInformation>R</EligibilityOrBenefitInformation><ServiceTypeCode>30</ServiceTypeCode><InsuranceTypeCode>14</InsuranceTypeCode><MonetaryAmount>0.0</MonetaryAmount><PercentageAsDecimal>0.0</PercentageAsDecimal><Quantity>0.0</Quantity></BenefitInformation><DatePeriod><DateTimeQualifier>290</DateTimeQualifier><DateTimePeriodFormatQualifier>D8</DateTimePeriodFormatQualifier><DateTimePeriod>20080606</DateTimePeriod></DatePeriod><LoopHeader><LoopIdentifierCode>2120</LoopIdentifierCode></LoopHeader><SubscriberBenefitRelatedEntityName><Name><EntityIdentifierCode1>PRP</EntityIdentifierCode1><EntityTypeQualifier>2</EntityTypeQualifier><NameLastOrOrganizationName>AUTO NO FAULT INS</NameLastOrOrganizationName></Name></SubscriberBenefitRelatedEntityName><LoopTrailer><LoopIdentifierCode>2120</LoopIdentifierCode></LoopTrailer></SubscriberBenefitInformation></SubscriberName></SubscriberLevel></InformationReceiverLevel></InformationSourceLevel><TranSetTrailer><NumberOfIncludedSegments>102</NumberOfIncludedSegments><TransactionSetControlNumber>0001</TransactionSetControlNumber></TranSetTrailer></BenefitResponse>";
            benResponse.ReturnedDataValidationTicket.TicketId = "c1519b5e-227e-11e1-a986-41c0bff916c0";
            benResponse.ReturnedDataValidationTicket.BenefitsResponse
                .BenefitsResponseParseStrategy = typeof(GovernmentMedicareCoverage).ToString();
            benResponse.FacilityCode = "DHW";
            ParseCoverageContext pcc = new ParseCoverageContext();
            pcc.ParseAndSetCoverageConstraints(benResponse);


            Assert.IsTrue(benResponse.CoverageConstraintsCollection.Count > 0, "The response was expecting at lease" +
                " one constraint to be added to the CoverageConstraints collection");
            Assert.AreEqual("9/1/2001 12:00:00 AM", ((MedicareConstraints)benResponse.CoverageConstraintsCollection[0]).PartACoverageEffectiveDate.Date.ToString(), "Medicare Part A - Invalid Date parsed");
            Assert.IsTrue(((MedicareConstraints)benResponse.CoverageConstraintsCollection[0]).PartACoverage == YesNoFlag.Yes);
            Assert.AreEqual("10/22/2001 12:00:00 AM", ((MedicareConstraints)benResponse.CoverageConstraintsCollection[0]).PartBCoverageEffectiveDate.Date.ToString(), "Medicare Part B -Invalid Date parsed");
            Assert.IsTrue(((MedicareConstraints)benResponse.CoverageConstraintsCollection[0]).PartBCoverage == YesNoFlag.Yes);

        }

        [Test]
        public void TestMedcaidConstraintCreated()
        {

            SetCoverageStrategy(typeof(GovernmentMedicaidCoverage).ToString(), typeof(GovernmentMedicaidCoverage).ToString());
            Assert.IsTrue(benResponse.CoverageConstraintsCollection.Count == 0, "Government Medicaid should not be parsed due to " +
                          " Configuration settings.");
        }

        [Test()]
        public void TestGovernmentOtherConstraintCreated()
        {
            SetCoverageStrategy(typeof(GovernmentOtherCoverage).ToString(), typeof(GovernmentOtherCoverage).ToString());
            Assert.IsTrue(benResponse.CoverageConstraintsCollection.Count == 0,
                          "Government Other should not be parsed due to " +
                          " Configuration settings.");
        }

        /// <summary>
        /// This test was relying on the order of elements in a foreach statement in the code under test and 
        /// started failing when run under a .NET 4.0 test project after the upgrade to Visual Studio 2010.
        /// The intent of the test is not clear however it was modified to make it pass while keeping the 
        /// logic as close to the original test as possible 
        /// </summary>
        [Test]
        public void TestCommercialContraintExpectedResults()
        {
            SetCoverageStrategy(typeof(CommercialCoverage) + "-InOut", typeof(CommercialCoverage) + "-InOut");
            var constraints = benResponse.CoverageConstraintsCollection[0] as CommercialConstraints;

            var details = constraints.BenefitsCategoryDetails.Cast<BenefitsCategoryDetails>().ToList();
            bool result = details.Where(x => x.CoInsurance == 50).Count() > 0;
            Assert.IsTrue(result);
        }

        [Test]
        [ExpectedException(typeof(ArgumentNullException))]
        public void TestNullBenefitResponse()
        {
            ParseCoverageContext pcc = new ParseCoverageContext();
            pcc.ParseAndSetCoverageConstraints(null);
        }

        [TestFixtureSetUp]
        public static void Init()
        {
            benResponse = new BenefitsValidationResponse();
        }

        private string GetXmlStringFor(string name)
        {
            XmlDocument doc = new XmlDocument();
            Stream xmlStream;
            string xmlFileName = String.Empty;

            switch (name)
            {
                case "PatientAccess.Domain.CommercialCoverage-WithNewPercentField":
                    xmlFileName = "271CommercialTestDataWithNewPercentField.xml";
                    break;
                case "PatientAccess.Domain.CommercialCoverage":
                    xmlFileName = "271CommercialTestData.xml";
                    break;
                case "PatientAccess.Domain.GovernmentMedicareCoverage":
                    xmlFileName = "271MedicareTestData.xml";
                    break;
                case "PatientAccess.Domain.GovernmentOtherCoverage":
                    xmlFileName = "271GovernmentOtherTestData.xml";
                    break;
                case "PatientAccess.Domain.GovernmentMedicaidCoverage":
                    xmlFileName = "271MedicaidTestData.xml";
                    break;
                case "PatientAccess.Domain.CommercialCoverage-InOut":
                    xmlFileName = "271CommercialInAndOutTestData.xml";
                    break;
                default:
                    break;
            }

            xmlStream =
                this.LoadFileFromResources(xmlFileName);
            doc.Load(xmlStream);
            xmlStream.Close();

            return doc.InnerXml;

        }

        private void SetCoverageStrategy(string name, string nameOfTestXML)
        {
            benResponse.CoverageConstraintsCollection.Clear();
            benResponse.ReturnedDataValidationTicket = new DataValidationTicket();
            benResponse.PayorXmlMessage = GetXmlStringFor(nameOfTestXML);
            benResponse.ReturnedDataValidationTicket.BenefitsResponse
                .BenefitsResponseParseStrategy = name;
            benResponse.FacilityCode = "ACO";
            ParseCoverageContext pcc = new ParseCoverageContext();
            pcc.ParseAndSetCoverageConstraints(benResponse);
        }

        private static BenefitsValidationResponse benResponse = null;
    }
}
