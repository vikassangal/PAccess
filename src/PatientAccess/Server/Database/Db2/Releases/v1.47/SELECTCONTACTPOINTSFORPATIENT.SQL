--  Generate SQL 
--  Version:                   	V7R2M0 140418 
--  Generated on:              	08/09/18 04:41:05 
--  Relational Database:       	DVLA 
--  Standards Option:          	DB2 for i 
SET PATH *LIBL ; 
  
CREATE PROCEDURE PACCESS.SELECTCONTACTPOINTSFORPATIENT ( 
	IN P_FACILITY_ID INTEGER , 
	IN P_MRN INTEGER ) 
	DYNAMIC RESULT SETS 10 
	LANGUAGE SQL 
	SPECIFIC PACCESS.SELPATCONP 
	NOT DETERMINISTIC 
	MODIFIES SQL DATA 
	CALLED ON NULL INPUT 
	SET OPTION  ALWBLK = *ALLREAD , 
	ALWCPYDTA = *OPTIMIZE , 
	COMMIT = *NONE , 
	DBGVIEW = *SOURCE , 
	DECRESULT = (31, 31, 00) , 
	DFTRDBCOL = *NONE , 
	DLYPRP = *NO , 
	DYNDFTCOL = *NO , 
	DYNUSRPRF = *USER , 
	RDBCNNMTH = *RUW , 
	SRTSEQ = *HEX   
	P1 : BEGIN DECLARE CURSOR1 CURSOR 
FOR SELECT 0 AS ADDRESSID , 
TRIM ( PATDEMO . MDPADR ) AS ADDRESS1 , 
TRIM ( PATDEMO . MDPADRE1 ) AS ADDRESS1EXTENDED , 
TRIM ( PATDEMO . MDPADRE2 ) AS ADDRESS2EXTENDED , 
  
'' AS ADDRESS2 , TRIM ( PATDEMO . MDPCIT ) AS CITY , 
0 AS STATEID , PATDEMO . MDPSTE AS STATECODE , 
TRIM ( STATE . QTSTN ) AS STATEDESCRIPTION , 
RTRIM ( PATDEMO . MDPZPA ) || 
RTRIM ( PATDEMO . MDPZ4A ) AS POSTALCODE , 
0 AS COUNTRYID , '' AS COUNTRYCODE , 
'' AS COUNTRYDESCRIPTION , 0 AS COUNTYID , 
LPAD ( TRIM ( PATDEMO . MDPCCD ) , 3 , '0' ) AS COUNTYCODE , 
TRIM ( COUNTY . QTCNTN ) AS COUNTYDESCRIPTION , 
'' AS FIPSCOUNTYCODE , '' AS PHONECOUNTRYCODE ,  -- parsing into AreaCode and PhoneNumber will be done 
-- in the broker 
TRIM ( PATDEMO . MDPACD ) AS AREACODE , 
TRIM ( PATDEMO . MDPPH# ) AS PHONENUMBER , 
TRIM ( PATDEMO . MDCLPH ) AS CELLPHONENUMBER , 
TRIM ( PATDEMO . MDEMAL ) AS EMAILADDRESS , 
0 AS TYPEOFADDRESSID , 
'MAILING' AS ADDRESSDESCRIPTION , 
0 AS TYPEOFCONTACTPOINTID , 
'MAILING' AS CONTACTPOINTDESCRIPTION  -- this is obsolete 
--ea.MDployerAddressNumber as EmployerAddressNumber 
FROM  HPADMDP PATDEMO 
LEFT OUTER JOIN  HPADQTSZ STATE ON 
PATDEMO . MDPSTE = STATE . QTKEY AND 
STATE . QTHSP# = 999 
LEFT OUTER JOIN  HPADQTCO COUNTY ON 
LPAD ( TRIM ( PATDEMO . MDPCCD ) , 
3 , '0' ) = COUNTY . QTKEY 
AND COUNTY . QTHSP# = P_FACILITY_ID WHERE 
PATDEMO . MDHSP# = P_FACILITY_ID 
AND PATDEMO . MDMRC# = P_MRN 
UNION SELECT 0 AS ADDRESSID , 
TRIM ( PATDEMO . MDMADR ) AS ADDRESS1 , 
TRIM ( PATDEMO . MDMADRE1 ) AS ADDRESS1EXTENDED , 
TRIM ( PATDEMO . MDMADRE2 ) AS ADDRESS2EXTENDED , 
'' AS ADDRESS2 , 
TRIM ( PATDEMO . MDMCIT ) AS CITY , 
0 AS STATEID , PATDEMO . MDMSTE AS STATECODE , 
TRIM ( STATE . QTSTN ) AS STATEDESCRIPTION , 
RTRIM ( PATDEMO . MDMZPA ) || 
RTRIM ( PATDEMO . MDMZ4A ) AS POSTALCODE , 
0 AS COUNTRYID , 
'' AS COUNTRYCODE , 
'' AS COUNTRYDESCRIPTION , 0 AS COUNTYID , 
'' AS COUNTYCODE , 
'' AS COUNTYDESCRIPTION , 
TRIM ( PATDEMO . MDCNTY ) AS FIPSCOUNTYCODE , 
'' AS PHONECOUNTRYCODE ,  -- parsing into AreaCode and PhoneNumber will be done in the broker 
TRIM ( PATDEMO . MDMACD ) AS AREACODE , 
TRIM ( PATDEMO . MDMPH# ) AS PHONENUMBER , 
TRIM ( PATDEMO . MDCLPH ) AS CELLPHONENUMBER , 
TRIM ( PATDEMO . MDEMAL ) AS EMAILADDRESS , 
0 AS TYPEOFADDRESSID , 'PHYSICAL' 
AS ADDRESSDESCRIPTION , 
0 AS TYPEOFCONTACTPOINTID , 'PHYSICAL' 
AS CONTACTPOINTDESCRIPTION  -- this is obsolete 
--ea.MDployerAddressNumber as EmployerAddressNumber 
FROM  HPADMDP PATDEMO 
LEFT OUTER JOIN  HPADQTSZ STATE ON 
PATDEMO . MDMSTE = STATE . QTKEY 
AND STATE . QTHSP# = 999 
WHERE PATDEMO . MDHSP# = P_FACILITY_ID AND 
PATDEMO . MDMRC# = P_MRN ; OPEN CURSOR1 ; END P1  ; 
  
GRANT ALTER , EXECUTE   
ON SPECIFIC PROCEDURE PACCESS.SELPATCONP 
TO RMTGRPPRF WITH GRANT OPTION ; 
  
GRANT ALTER , EXECUTE   
ON SPECIFIC PROCEDURE PACCESS.SELPATCONP 
TO XAGRPPRF WITH GRANT OPTION ;
