--  Generate SQL 
--  Version:                   	V7R2M0 140418 
--  Generated on:              	04/11/19 07:38:28 
--  Relational Database:       	DVLA 
--  Standards Option:          	DB2 for i 
SET PATH *LIBL ; 
   
CREATE PROCEDURE PACCESS.MPIACCOUNTDETAILSFOR ( 
	IN P_FACILITYID INTEGER , 
	IN P_ACCTNO INTEGER ) 
	DYNAMIC RESULT SETS 2 
	LANGUAGE SQL 
	SPECIFIC PACCESS.MPIACCDTL 
	NOT DETERMINISTIC 
	READS SQL DATA 
	CALLED ON NULL INPUT 
	SET OPTION  ALWBLK = *ALLREAD , 
	ALWCPYDTA = *OPTIMIZE , 
	COMMIT = *NONE , 
	DBGVIEW = *SOURCE , 
	CLOSQLCSR = *ENDACTGRP , 
	DECRESULT = (31, 31, 00) , 
	DFTRDBCOL = *NONE , 
	DLYPRP = *NO , 
	DYNDFTCOL = *NO , 
	DYNUSRPRF = *USER , 
	RDBCNNMTH = *RUW , 
	SRTSEQ = *HEX   
	P1 : BEGIN 
DECLARE CURSOR1 CURSOR 
FOR SELECT MDP . MDPLNM AS LASTNAME , 
MDP . MDPFNM AS FIRSTNAME , 
MDP . MDPMI AS MIDDLEINITIAL , 
MDP . MDNMTL AS SUFFIX , 
AKA . AKPLNM AS AKLASTNAME , 
AKA . AKPFNM AS AKFIRSTNAME , 
MDP . MDMRC# AS MEDICALRECORDNUMBER , 
MDP . MDSSN AS SSN , 
MDP . MDSEX AS GENDER , 
MDP . MDDOB AS DOB , 
MDP . MDMAR AS MARITALSTATUS , 
MDP . MDRACE AS RACE , 
MDP . MDETHC AS ETHNICITY ,    

MDP . MDSEXBIRTH	AS BIRTHSEX ,
MDP . MDRACE2	AS RACE2 ,
MDP . MDNTNLT1	AS NATIONALITY1 ,
MDP . MDNTNLT2	AS	NATIONALITY2 ,
MDP . MDETHC2	AS ETHNICITY2 ,
MDP . MDDESCNT1	AS	DESCENT1 ,
MDP . MDDESCNT2	AS	DESCENT2,

MDP . MDAGE AS AGE , 
MDP . MDPADR AS LOCALADDRESS , 
MDP . MDPADRE1 AS LOCALADDRESS1EXTENDED , 
MDP . MDPADRE2 AS LOCALADDRESS2EXTENDED , 
  
--MDP.MDPCTY AS LOCALCITY, 
-- 
MDP . MDPCIT AS LOCALADDRESSCITY , 
MDP . MDPSTE AS LOCALSTATEID , 
MDP . MDPZIP AS ZIPCODE , 
MDP . MDPACD AS AREACODE , 
MDP . MDPPH# AS PHONENUMBER , 
MDP . MDCLPH AS CELLPHONE , 
MDP . MDPCUN AS COUNTRYCODE , 
MDP . MDPZPA AS LOCALZIP , 
MDP . MDPZ4A AS LOCALZIPEXTN , 
MDP . MDMADR AS PERMANENTADDRESS , 
MDP . MDMADRE1 AS PERMANENTADDRESS1EXTENDED , 
MDP . MDMADRE2 AS PERMANENTADDRESS2EXTENDED , 
MDP . MDMCIT AS PERMANENTCITY , 
MDP . MDMSTE AS PERMANENTSTATECODE , 
MDP . MDPZIP AS PERMANENTZIP , 
MDP . MDMZP4 AS PERMANENTZIPEXTN , 
MDP . MDMACD AS PERMANENTAREACODE , 
MDP . MDMPH# AS PERMANENTPHONE , 
MDP . MDMZPA AS PATPERMANENTZIP , 
MDP . MDPZ4A AS PATPERMANENTZIPEXTN , 
MDP . MDDL# AS DRIVINGLICENSE , 
MDP . MDPPT# AS PASSPORTNUMBER , 
MDP . MDICUN AS PASSPORTCOUNTRY , 
MDP . MDMNM AS MAIDENNAME , 
MDP . MDMONM AS MOTHERSNAME , 
MDP . MDFANM AS FATHERSNAME , 
MDP . MDBLDL AS BLOODLESS , 
RVP . RVPCNY AS DNR , 
MDP . MDPMRC AS PREVIOUSMRN , 
MDP . MDNTPP AS NPP , 
MDP . MDNPPV AS NPPVER , 
MDP . MDDTRC AS NPPVERSIONDATE , 
MDP . MDNPPS AS NPPSIGNATURESTATUS , 
MDP . MDNPPD AS NPPDATESIGNED , 
MDP . MDLSDT AS LASTUPDATED , 
MDP . MDLMD AS LASTMAINTENANCEDATE , 
RWP . RWCNFG AS CONFIDENTIALFLAG , 
RWP . RWACCT AS ACCOUNTNUMBER , 
RWP . RWAFAD AS ABSTRACTAGE , 
RWP . RWPTYP AS PATIENTTYPE , 
RWP . RWZB10 AS HOSPITALSERVICECODE , 
RWP . RWDIAG AS CHIEFCOMPLAINT , 
RWP . RWLAD AS ADMITDATE , 
RWP . RWLAT AS ADMITTIME , 
RWP . RWPSRC AS ADMITSOURCE , 
RWP . RWLDD AS DISCHARGEDATE , 
RWP . RWLDT AS DISCHARGETIME , 
RWP . RWDCOD AS DISCHARGECODE , 
RWP . RWRDR# AS REFERINGDRID , 
RWP . RWADR# AS ATTENDINGDRID , 
RWP . RWMDR# AS ADMITTINGDRID , 
RWP . RWODR# AS OPERATINGDRID , 
RWP . RWTDR# AS OTHERDRID , 
RVP . RVOB04 AS SEENINED , 
RWP . RWCL01 AS CLINICCODE1 , 
RWP . RWCL02 AS CLINICCODE2 , 
RWP . RWCL03 AS CLINICCODE3 , 
RWP . RWCL04 AS CLINICCODE4 , 
RWP . RWCL05 AS CLINICCODE5 , 
RWP . RWCL25 AS SITECODE , 
QCP . QCSST5 AS MULTISITEFLG , 
RWP . RWFC AS FINANCIALCODE , 
RWP . RWLMD AS LASTMAINTENCEDATEABSTRACT   
  
  
FROM HPDATA1.  HXMRRWP RWP 
  
  
LEFT OUTER JOIN TESTLIB . HPADMDP MDP 
  
  
ON ( MDP . MDHSP# = RWP . RWHSP# 
  
  
AND MDP . MDMRC# = RWP . RWMRC# 
  
AND 
MDHSP# = P_FACILITYID ) 
LEFT OUTER JOIN 
( SELECT 
RVOB04 , 
RVPCNY , 
  
  
RVHSP# , 
  
  
  
RVACCT 
  
  
FROM HPDATA1 . HXMRRVP 
  
  
  
WHERE RVHSP# = P_FACILITYID ) RVP 
  
  
  
ON ( RVP . RVHSP# = RWP . RWHSP# 
  
  
  
AND RWP . RWACCT = RVP . RVACCT ) 
LEFT OUTER JOIN ( 
SELECT 
AKPLNM , 
AKPFNM , 
AKEDAT , 
AKHSP# , 
AKTITL , 
AKMRC# 
FROM NMDATA1 . NMNHAKAP 
WHERE AKEDAT = 
( 
SELECT SUBSTR 
( MAX 
( INTEGER 
( 
CASE AKEDAT 
  
  
WHEN 0 THEN NULL 
  
  
ELSE RTRIM ( CASE 
  
  
WHEN LENGTH ( TRIM ( AKEDAT ) ) = 5 
  
  
THEN '200' || SUBSTR 
( TRIM ( AKEDAT ) , 1 , 1 ) 
  
ELSE 
( CASE 
  
WHEN 
INTEGER ( SUBSTR 
( TRIM ( AKEDAT ) , 1 , 2 ) ) < 50 
  
  
THEN '20' || SUBSTR ( TRIM ( AKEDAT ) , 1 , 2 ) 
  
  
ELSE '19' || SUBSTR 
( TRIM ( AKEDAT ) , 1 , 2 ) 
  
END ) 
  
  
END ) || CASE WHEN LENGTH ( TRIM ( AKEDAT ) ) = 5 
  
  
THEN SUBSTR ( TRIM ( AKEDAT ) , 2 , 2 ) 
  
  
ELSE SUBSTR ( TRIM ( AKEDAT ) , 3 , 2 ) 
  
  
END || CASE WHEN LENGTH ( TRIM ( AKEDAT ) ) = 5 
  
  
THEN SUBSTR ( TRIM ( AKEDAT ) , 4 , 2 ) 
  
  
ELSE SUBSTR ( AKEDAT , 5 , 2 ) 
  
  
END 
  
END 
  
) 
  
) 
  
, 3 ) 
AS ENTRYDATE 
  
FROM NMDATA1 . NMNHAKAP 
  
  
WHERE ( AKHSP# = P_FACILITYID ) 
  
  
AND ( AKMRC# = ( 
  
  
  
SELECT 
  
  
RWMRC# 
  
  
  
FROM HPDATA1 . HXMRRWP 
  
  
  
WHERE RWHSP# = P_FACILITYID 
  
  
  
AND RWACCT = P_ACCTNO 
  
  
  
) 
  
) 
  
) 
ORDER BY 
  
AKPLNM , 
  
  
AKPFNM , 
  
AKTITL 
  
  
FETCH FIRST 1 ROW ONLY ) AS 
AKA 
  
ON 
( AKA . AKHSP# = RWP . RWHSP# 
  
  
AND AKA . AKMRC# = MDP . MDMRC# ) 
  
  
LEFT OUTER JOIN HPDATA1 . HPADQCP1 QCP 
  
  
  
ON ( QCP . QCHSP# = RWP . RWHSP# ) 
  
  
WHERE RWP . RWHSP# = P_FACILITYID 
  
  
AND RWP . RWACCT = P_ACCTNO 
; 
  
OPEN CURSOR1 ; 
END P1  ; 
  
GRANT ALTER , EXECUTE   
ON SPECIFIC PROCEDURE PACCESS.MPIACCDTL 
TO HPPGMR WITH GRANT OPTION ; 
  
GRANT ALTER , EXECUTE   
ON SPECIFIC PROCEDURE PACCESS.MPIACCDTL 
TO RMTGRPPRF WITH GRANT OPTION ; 
  
GRANT ALTER , EXECUTE   
ON SPECIFIC PROCEDURE PACCESS.MPIACCDTL 
TO TURNOVER WITH GRANT OPTION ;
